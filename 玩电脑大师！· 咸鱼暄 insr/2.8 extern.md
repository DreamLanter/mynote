---

本文是 [咸鱼暄的 C++ 学习](https://www.yuque.com/xianyuxuan/coding/cpp) 的补充部分 [2 C++知识补充](https://www.yuque.com/xianyuxuan/coding/cpppp) 的一个章节。

---

如果我们想要使用其他代码文件中的变量，我们可以怎么做？我们知道， **#include** 可以用来包含其他的代码文件，其实际作用其实就是在编译时“复制”这段代码。但是，如果某个文件被引用了多次（例如 B, C 引用了 D ，A 引用了 B, C ，那么 D 其实就在 A 中被重复引用了），那么这个文件中的变量就会被重复定义，这是不符合语法标准的。此时，我们可以使用关键字 **extern** 来解决这一问题。<br />extern 放在变量或者函数之前，表示它只是一个声明而不是定义。声明是向编译器介绍一个标识符，它告诉编译器这个变量或者函数的定义在别的文件中，提示编译器遇到此变量和函数时在其他模块中寻找其定义。


### 2.8.1 链接属性
C++ 的符号（变量名、函数名等）有三种链接属性：

   - 外部链接属性

在代码块外面声明的全局变量具有外部链接属性。外部链接的变量在其他文件中可见。

   - 内部链接属性

**static** 和 **const** 修饰的全局变量具有内部链接属性。但是， **extern** 关键字修饰的 **const** 变量是外部链接的。内部链接的变量只在本文件中可见。

   - 无链接属性

在代码块内声明的变量具有无链接属性。无链接属性的变量只在当前代码块中可见。

如果代码块中的变量与全局变量同名，此时代码块中的变量会屏蔽全局的同名变量。如果此时需要调用全局变量，只需要使用范围解析运算符，即 ::_varName_ 。


### 2.8.2 变量的声明和定义
我们曾经学习过函数的声明和定义。类似地，变量也有声明和定义的区别。声明是向程序表明一个变量的类型和名字，而定义则用于按照其类型对变量分配存储空间，并可以进行初始化。<br />但是我们知道，代码 `int i;` 即使没有对 i 进行初始化，我们还是可以直接调用它（虽然这很可能导致数值上的错误），也就是 i 已经被分配了实际的内存，即这个语句是一个定义语句。

实际上，C/C++ 将未经 extern 关键字修饰的变量均视为变量的定义，而 extern 则是用来使用其他程序文件中外部链接的变量，即告诉编译器：这个变量在其他地方定义了，这里使用的是那个变量。例如 `extern int i;` 。<br />我们可以其他文件中外部链接的变量。但是，由于我们的每一个代码文件都必须是符合语法规则的，变量在使用前必须要被声明或定义，因此所使用的其他文件中的变量也必须在本文件或本文件包含的文件中被声明。例如：
```cpp
/*---in a.c---*/
int j = 1;
/*---in b.c---*/
#include<stdio.h>
extern int j;
int main(){
    printf("%d", j);
}
```
输出为 1。

但是，带有初始化的声明必然是定义。例如 `extern const int PI = 3.1415926;` ，这个语句定义了一个常量 PI，extern 的作用是让它具有外部链接属性，以便在其他文件中使用。注意：只有当 extern 处在代码块外部时才能被初始化；另外，如果包含的文件中已经存在了同名的外部链接变量，那么对 extern 修饰的同名变量进行初始化也是非法的。


另外，如同我们之前学到过的，函数的定义和声明取决于其是否有函数体。因此在函数的声明前写出 extern 是没有必要的。

---


### 参考资料

1. [OI Wiki](https://oi-wiki.org/)
2. [C++ 教程 | 菜鸟教程](https://www.runoob.com/cplusplus/cpp-tutorial.html)
3. C 语言中变量的声明和定义 [https://blog.csdn.net/skk18739788475/article/details/79643978](https://blog.csdn.net/skk18739788475/article/details/79643978)
4. 《C++编程思想》第一卷 2.2.1 声明与定义
